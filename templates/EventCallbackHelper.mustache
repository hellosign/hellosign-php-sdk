<?php
/**
 * EventCallbackValidate
 *
 * PHP version 7.3
 *
 * @category Class
 * @package  {{invokerPackage}}
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */

{{>partial_header}}
/**
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */

namespace {{invokerPackage}};

/**
 * EventCallbackHelper Class Doc Comment
 *
 * @category Class
{{#description}}
 * @description {{.}}
{{/description}}
 * @package  {{invokerPackage}}
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */
abstract class EventCallbackHelper
{
    public const EVENT_TYPE_ACCOUNT_CALLBACK = 'account_callback';

    public const EVENT_TYPE_APP_CALLBACK = 'app_callback';

    /**
     * Verify that a callback came from HelloSign.com
     */
    public static function isValid(
        string $api_key,
        Model\EventCallbackRequest $event_callback
    ): bool {
        $event = $event_callback->getEvent();

        $hash = hash_hmac(
            'sha256',
            $event->getEventTime() . $event->getEventType(),
            $api_key
        );

        return $event->getEventHash() === $hash;
    }

    /**
     * Identifies the callback type, one of "account_callback" or
     * "app_callback".
     *
     * "app_callback" will always include a value for "reported_for_app_id"
     */
    public static function getCallbackType(
        Model\EventCallbackRequest $event_callback
    ): string {
        $meta_data = $event_callback->getEvent()->getEventMetadata();

        return !empty($meta_data->getReportedForAppId())
            ? self::EVENT_TYPE_APP_CALLBACK
            : self::EVENT_TYPE_ACCOUNT_CALLBACK;
    }
}
